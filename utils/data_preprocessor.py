# -*- coding:utf-8 -*-

# 数据预处理器

import ddddocr
from PIL import Image
import base64
from io import BytesIO

def dddd_ocr_text(data):
    """
    进行OCR识别的函数
    :return: 识别之后的文本

    "base64": "data:image/jpg;base64,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",

    """

    # 分割data文本，得到头部信息和 Base64编码部分
    # encode_data = data.split(",")[1]
    encode_data = data
    print(encode_data)

    # 解码 Base64 元数据
    decode_data = base64.b64decode(encode_data)

    # 把解码数据调整为图像数据
    image = Image.open(BytesIO(decode_data))

    # 把图像数据转成字节数据
    image_bytes = BytesIO()
    image.save(image_bytes,format="PNG")
    image_bytes = image_bytes.getvalue()

    # 初始化
    ocr = ddddocr.DdddOcr()
    text = ocr.classification(image_bytes)
    return text



if __name__ == '__main__':
    data = "data:image/jpeg;base64,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"
    print(dddd_ocr_text(data))


